<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ Sistema de Rotaciones</title>
    <link rel="stylesheet" href="styles.css?v=2025102029">
</head>
<body>
    <!-- Contenedor para notificaciones -->
    <div id="notifications-container" style="position: fixed; top: 20px; right: 20px; z-index: 10000;"></div>

    <!-- Loading inicial -->
    <div id="loading-screen" style="text-align: center; padding: 50px; font-family: Arial, sans-serif;">
        <h2>ğŸ”„ Cargando aplicaciÃ³n...</h2>
        <p>Verificando autenticaciÃ³n...</p>
    </div>

    <!-- Pantalla de acceso denegado -->
    <div id="access-denied" style="display: none; text-align: center; padding: 50px; font-family: Arial, sans-serif; background: #f8d7da; color: #721c24;">
        <h2>ğŸš« Acceso Denegado</h2>
        <p>Tu sesiÃ³n ha expirado o no tienes permisos.</p>
        <button onclick="window.location.href='login.html'" 
                style="padding: 12px 24px; font-size: 16px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">
            ğŸ” Ir a Login
        </button>
    </div>

    <!-- Banner de jornada pendiente -->
    <div id="bannerJornadaPendiente" class="banner-jornada-pendiente" style="display: none;">
        <div class="banner-content">
            <div class="banner-info">
                <span class="banner-icon">ğŸ“</span>
                <span class="banner-texto"></span>
            </div>
            <div class="banner-actions">
                <button id="continuarPlanificando" class="btn-continuar">âœï¸ Continuar Editando</button>
                <button id="eliminarBorrador" class="btn-eliminar">ğŸ—‘ï¸ Eliminar</button>
                <button id="cerrarBanner" class="btn-cerrar">âœ•</button>
            </div>
        </div>
    </div>

    <!-- Modal Setup (OCULTO) -->
    <div id="setupInicial" class="setup-modal" style="display: none !important;">
        <!-- Contenido del setup modal oculto -->
    </div>

    <!-- AplicaciÃ³n Principal -->
    <div class="container" id="mainApp" style="display: none;">
        <div class="header">
            <h1>ğŸ Sistema de Rotaciones</h1>
            <div class="user-info" style="position: absolute; top: 20px; right: 20px; background: #f8f9fa; padding: 10px; border-radius: 8px; font-size: 14px;">
                <span id="current-user">Cargando...</span>
                <button onclick="logout()" style="margin-left: 10px; padding: 5px 10px; background: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer;">
                    ğŸšª Logout
                </button>
            </div>
            <div class="tabs">
                <button class="tab-button active" data-tab="jornadas">ğŸ“… Jornadas</button>
                <button class="tab-button" data-tab="jugadoras">ğŸ‘¥ Equipo</button>
                <button class="tab-button" data-tab="historial">ğŸ“Š Historial</button>
                <button class="tab-button" data-tab="admin" id="admin-tab" style="display: none;">âš™ï¸ Admin</button>
            </div>
        </div>

        <!-- Contenido de Jornadas -->
        <div id="jornadas" class="tab-content active">
            <div id="jornada-nueva">
                <h3>Nueva Jornada</h3>
                <div class="jornada-config">
                    <input type="date" id="fechaJornada">
                    <button id="crearJornada" class="btn-crear">+ Crear Jornada</button>
                </div>
            </div>

            <div id="jornadaActual" class="jornada-container" style="display: none;">
                <div class="jornada-header">
                    <h3 id="tituloJornada">Jornada: Semana del [fecha]</h3>
                    <div class="jornada-controles">
                        <div class="jornada-progreso">
                            <span id="progresoJornada">Paso 1 de 3</span>
                        </div>
                        <div class="navegacion-rapida">
                            <button id="irLunes" class="btn-nav active" onclick="app.irAPaso('lunes')">Lunes</button>
                            <button id="irMiercoles" class="btn-nav" onclick="app.irAPaso('miercoles')">MiÃ©rcoles</button>
                            <button id="irSabado" class="btn-nav" onclick="app.irAPaso('sabado')">SÃ¡bado</button>
                            <button id="volverInicio" class="btn-volver" onclick="app.volverAInicioJornada()">ğŸ”„ Nueva Jornada</button>
                        </div>
                    </div>
                </div>

                <!-- Paso 1: Entrenamiento Lunes -->
                <div id="pasoLunes" class="jornada-paso active">
                    <div class="paso-header">
                        <h4 id="tituloLunes">ğŸ“… Entrenamiento Lunes</h4>
                        <p>Selecciona quiÃ©nes asistieron al entrenamiento</p>
                    </div>
                    <div class="jugadoras-grid" id="asistenciaLunesGrid"></div>
                    <div class="paso-actions">
                        <button id="siguienteLunes" class="btn-siguiente">Continuar a MiÃ©rcoles</button>
                    </div>
                </div>

                <!-- Paso 2: Entrenamiento MiÃ©rcoles -->
                <div id="pasoMiercoles" class="jornada-paso">
                    <div class="paso-header">
                        <h4 id="tituloMiercoles">ğŸ“… Entrenamiento MiÃ©rcoles</h4>
                        <p>Selecciona quiÃ©nes asistieron al entrenamiento</p>
                    </div>
                    <div class="jugadoras-grid" id="asistenciaMiercolesGrid"></div>
                    <div class="paso-actions">
                        <button id="volverLunes" class="btn-anterior">Volver a Lunes</button>
                        <button id="siguienteMiercoles" class="btn-siguiente">Continuar a SÃ¡bado</button>
                    </div>
                </div>

                <!-- Paso 3: Partido SÃ¡bado -->
                <div id="pasoSabado" class="jornada-paso">
                    <div class="paso-header">
                        <h4 id="tituloSabado">ğŸ Partido SÃ¡bado</h4>
                        <p>Selecciona quiÃ©nes van a ir al partido y planifica la rotaciÃ³n</p>
                    </div>
                    
                    <div class="partido-config">
                        <h5>ConfiguraciÃ³n del Partido</h5>
                        <div class="config-grid">
                            <div class="form-group">
                                <label for="puntosSet1Jornada">Set 1:</label>
                                <input type="number" id="puntosSet1Jornada" value="25" min="15" max="50">
                            </div>
                            <div class="form-group">
                                <label for="puntosSet2Jornada">Set 2:</label>
                                <input type="number" id="puntosSet2Jornada" value="25" min="15" max="50">
                            </div>
                        </div>
                    </div>

                    <div class="jugadoras-grid" id="asistenciaSabadoGrid"></div>
                    
                    <!-- Contenedor principal para la planificaciÃ³n inteligente -->
                    <div id="configuracionPartido" class="configuracion-partido">
                        <!-- La planificaciÃ³n se genera automÃ¡ticamente aquÃ­ -->
                    </div>
                    
                    <div class="paso-actions">
                        <button id="volverMiercoles" class="btn-anterior">Volver a MiÃ©rcoles</button>
                        <button id="guardarBorrador" class="btn-guardar-borrador">ğŸ’¾ Guardar Borrador</button>
                        <button id="completarJornada" class="btn-completar">âœ… Completar Jornada</button>
                    </div>
                </div>
            </div>

            <div id="listaJornadas"></div>
            <!-- Div necesario para la lista de setup -->
            <div id="listaSetup" style="display:none;"></div>

            <!-- Planificador de sets independiente -->
            <div id="planificadorSets" class="planificador-sets" style="display: none;">
                <!-- Contenido del planificador -->
            </div>
        </div>

        <!-- Contenido de Equipo -->
        <div id="jugadoras" class="tab-content">
            <div class="section-header">
                <h3>ğŸ‘¥ GestiÃ³n del Equipo</h3>
                <div class="equipo-actions">
                    <button id="addJugadora" class="btn-add">+ AÃ±adir Jugador/a</button>
                    <button id="recalcularEstadisticas" class="btn-recalcular">ğŸ“Š Recalcular EstadÃ­sticas</button>
                    <button id="resetearEquipo" class="btn-reset">ğŸ”„ Reset Equipo</button>
                </div>
            </div>
            
            <div id="formJugadora" class="form-jugadora" style="display: none;">
                <h4>AÃ±adir Jugador/a</h4>
                <div class="form-row">
                    <input type="text" id="nombreJugadora" placeholder="Nombre">
                    <input type="number" id="dorsalJugadora" placeholder="Dorsal" min="1" max="99">
                    <select id="posicionJugadora">
                        <option value="jugadora">Jugador/a</option>
                        <option value="colocadora">Colocador/a</option>
                        <option value="central">Central</option>
                    </select>
                        <button id="guardarJugadora" class="btn-save" type="button">Guardar</button>
                        <button id="cancelarJugadora" class="btn-cancel" type="button">Cancelar</button>
                </div>
            </div>

            <div id="listaJugadoras" class="lista-equipo"></div>
        </div>

        <!-- Contenido de Historial -->
        <div id="historial" class="tab-content">
            <div class="filtros-historial">
                <div class="info-filtros">
                    <h4>ğŸ” Filtros de BÃºsqueda</h4>
                    <p>Filtra las jornadas por mes o por jugadora especÃ­fica</p>
                </div>
                
                <div class="filtros-row">
                    <div class="filtro-item">
                        <label>Filtrar por mes:</label>
                        <select id="filtroMes">
                            <option value="">Todos los meses</option>
                        </select>
                    </div>
                    
                    <div class="filtro-item">
                        <label>Filtrar por jugador/a:</label>
                        <select id="filtroJugadora">
                            <option value="">Todos/as</option>
                        </select>
                    </div>
                    
                    <div class="filtro-acciones">
                        <button id="filtrarHistorial" class="btn-aplicar">ğŸ” Filtrar</button>
                        <button id="limpiarFiltro" class="btn-limpiar">ğŸ—‘ï¸ Limpiar</button>
                        <button id="exportarDatos" class="btn-exportar">ğŸ“¥ Exportar Datos</button>
                        <button id="importarDatos" class="btn-importar">ğŸ“¤ Importar Datos</button>
                        <button id="eliminarSeleccionadas" class="btn-eliminar">ğŸ—‘ï¸ Eliminar Seleccionados</button>
                        <input type="file" id="archivoImportar" accept=".json" style="display: none;">
                    </div>
                </div>
            </div>
            
            <div id="listaHistorial"></div>
        </div>

        <!-- Contenido de AdministraciÃ³n -->
        <div id="admin" class="tab-content">
            <div class="admin-container">
                <div class="admin-header">
                    <h3>âš™ï¸ Panel de AdministraciÃ³n</h3>
                    <div class="admin-info">
                        <span id="current-user-info"></span>
                        <button id="logout-btn" class="btn-logout">ğŸšª Cerrar SesiÃ³n</button>
                    </div>
                </div>

                <!-- GestiÃ³n de Usuarios Predefinidos -->
                <div class="admin-section">
                    <h4>ğŸ‘¥ GestiÃ³n de Usuarios del Sistema</h4>
                    <p style="color: #666; margin-bottom: 15px;">
                        âš™ï¸ Administra los usuarios que podrÃ¡n acceder al sistema.
                    </p>
                    
                    <div class="admin-card">
                        <h5>Usuarios del Sistema</h5>
                        <div id="system-users-editor">
                            <!-- Se llenarÃ¡ dinÃ¡micamente -->
                        </div>
                        <div style="margin-top: 20px; display: flex; gap: 10px; flex-wrap: wrap;">
                            <button id="add-system-user-btn" class="btn-create-user">â• Agregar Usuario</button>
                            <button id="save-system-users-btn" class="btn-system" style="background: #28a745; color: white;">ğŸ’¾ Guardar Cambios</button>
                            <button id="load-current-users-btn" class="btn-system" style="background: #17a2b8; color: white;">ğŸ”„ Recargar</button>
                            <button id="generate-code-btn" class="btn-system" style="background: #ff9800; color: white;">ğŸ“‹ Generar CÃ³digo para GitHub</button>
                        </div>
                    </div>

                    <!-- CÃ³digo para GitHub -->
                    <div class="admin-card" id="github-code-section" style="display: none;">
                        <h5>ğŸ“‹ CÃ³digo para GitHub</h5>
                        <p style="color: #666; margin-bottom: 10px;">
                            Para que estos usuarios estÃ©n disponibles en GitHub Pages:
                        </p>
                        <ol style="color: #666; margin-bottom: 15px; padding-left: 20px;">
                            <li>Copia el cÃ³digo de abajo</li>
                            <li>Abre el archivo <code>auth.js</code></li>
                            <li>Busca la lÃ­nea que dice <code>const systemUsers = {</code> (aproximadamente lÃ­nea 202)</li>
                            <li>Reemplaza TODO el objeto <code>systemUsers</code> con el cÃ³digo copiado</li>
                            <li>Guarda <code>auth.js</code> y sÃºbelo a GitHub</li>
                        </ol>
                        <div style="position: relative;">
                            <button id="copy-github-code-btn" class="btn-system" style="position: absolute; top: 10px; right: 10px; z-index: 10; background: #28a745; color: white;">
                                ğŸ“‹ Copiar CÃ³digo
                            </button>
                            <pre id="github-code" style="background: #f5f5f5; padding: 15px; border-radius: 5px; overflow-x: auto; max-height: 400px; font-family: 'Courier New', monospace; font-size: 12px; border: 2px solid #28a745;"></pre>
                        </div>
                    </div>
                </div>

                <!-- GestiÃ³n de Sistema -->
                <div class="admin-section">
                    <h4>ğŸ”§ GestiÃ³n del Sistema</h4>
                    
                    <div class="admin-card">
                        <h5>Opciones de Sistema</h5>
                        <div class="system-actions">
                            <button id="backup-data-btn" class="btn-system">ğŸ’¾ Respaldar Datos</button>
                            <button id="clear-data-btn" class="btn-system btn-danger">ğŸ—‘ï¸ Limpiar Datos</button>
                            <button id="reset-users-btn" class="btn-system btn-danger">ğŸ‘¥ Resetear Usuarios</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        </div>

    </div>

    <!-- Modal para sustituciones -->
    <div id="modalSustitucion" class="modal-sustitucion" style="display: none;">
        <div class="modal-content">
            <h4>AÃ±adir SustituciÃ³n</h4>
            <div class="sustitucion-form">
                <div class="form-group">
                    <label>Sale:</label>
                    <select id="jugadoraSale">
                        <option value="">Seleccionar...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Entra:</label>
                    <select id="jugadoraEntra">
                        <option value="">Seleccionar...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Punto del cambio:</label>
                    <input type="text" id="puntoCambio" placeholder="ej: 12-5, 3-8, etc.">
                </div>
                <div class="modal-actions">
                    <button id="confirmarSustitucion" class="btn-confirmar">âœ… Confirmar</button>
                    <button id="cancelarSustitucion" class="btn-cancelar">âŒ Cancelar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para editar usuario -->
    <div id="edit-user-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h4>âœï¸ Editar Usuario</h4>
                <button type="button" class="modal-close" id="close-edit-user">&times;</button>
            </div>
            <form id="edit-user-form">
                <div class="form-section">
                    <h5>ğŸ“ InformaciÃ³n del Usuario</h5>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-user-username">ğŸ‘¤ Usuario:</label>
                            <input type="text" id="edit-user-username" placeholder="Nombre de usuario" required>
                        </div>
                        <div class="form-group">
                            <label for="edit-user-name">ğŸ“‹ Nombre completo:</label>
                            <input type="text" id="edit-user-name" placeholder="Nombre y apellido" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-user-password">ğŸ”‘ Nueva ContraseÃ±a:</label>
                            <input type="password" id="edit-user-password" placeholder="Nueva contraseÃ±a (mÃ­n. 4 caracteres)">
                            <small class="form-help">Dejar vacÃ­o para mantener la contraseÃ±a actual</small>
                        </div>
                        <div class="form-group">
                            <label for="edit-user-type">ğŸ­ Tipo de Usuario:</label>
                            <select id="edit-user-type">
                                <option value="false">Usuario Normal</option>
                                <option value="true">Administrador</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="submit" class="btn-confirmar">ğŸ’¾ Guardar Cambios</button>
                    <button type="button" id="cancel-edit-user" class="btn-cancelar">âŒ Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de confirmaciÃ³n mejorado -->
    <div id="confirm-modal" class="modal" style="display: none;">
        <div class="modal-content confirm-modal-content">
            <div class="confirm-header">
                <div class="confirm-icon">âš ï¸</div>
                <h4 id="confirm-title">Confirmar AcciÃ³n</h4>
            </div>
            <div class="confirm-body">
                <p id="confirm-message"></p>
            </div>
            <div class="confirm-actions">
                <button id="confirm-yes" class="btn-confirm-yes">âœ… Confirmar</button>
                <button id="confirm-no" class="btn-confirm-no">âŒ Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Modal para seleccionar jugadora -->
    <div id="modal-seleccion-jugadora" class="modal" style="display: none;">
        <div class="modal-content modal-seleccion-content">
            <div class="modal-header">
                <h4 id="titulo-seleccion-jugadora">Seleccionar Jugador/a</h4>
                <button class="btn-cerrar-modal" onclick="app.cerrarModalSeleccion()">âœ•</button>
            </div>
            <div class="modal-body">
                <div id="lista-jugadoras-modal" class="lista-jugadoras-modal">
                    <!-- Se genera dinÃ¡micamente -->
                </div>
            </div>
        </div>
    </div>

    <script src="auth.js"></script>
    <script src="app.js?v=2025102036"></script>
</body>
</html>
